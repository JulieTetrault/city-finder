services:
  devcontainer_review_challenge_cpp:
    build: .
    command: >
      /bin/bash -c "sleep infinity"
    container_name: devcontainer_review_challenge_cpp
    environment:
      - ACTIONS_CACHE_URL=${ACTIONS_CACHE_URL-}
      - ACTIONS_RUNTIME_TOKEN=${ACTIONS_RUNTIME_TOKEN-}
      - CMAKE_EXPORT_COMPILE_COMMANDS=ON
      - CMAKE_GENERATOR=Ninja
      - VCPKG_BINARY_SOURCES=${VCPKG_BINARY_SOURCES-}
    user: root
    volumes:
      - ..:/workspace
      - builds:/builds
      - cache:/root/.cache
    working_dir: /builds

    # Required for ptrace-based debuggers like C++, Go, and Rust
    cap_add:
      - SYS_PTRACE
    security_opt:
      - seccomp:unconfined

    ports:
      - "8080:8080"

volumes:
  builds:
  cache:
